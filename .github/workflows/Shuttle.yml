name: Deploy to Shuttle

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        
      - name: Install Shuttle CLI
        run: |
          curl -sSL https://github.com/shuttle-hq/shuttle/releases/latest/download/shuttle-x86_64-unknown-linux-gnu.tar.gz -o shuttle.tar.gz
          tar -xzf shuttle.tar.gz
          sudo mv shuttle /usr/local/bin/shuttle
          rm shuttle.tar.gz
        
      - name: Create temp directory
        run: mkdir -p temp
        
      - name: Deploy to Shuttle
        run: |
          cargo shuttle deploy --allow-dirty
        env:
          SHUTTLE_API_KEY: ${{ secrets.SHUTTLE_API_KEY }}
